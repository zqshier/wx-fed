/*! For license information please see verification.js.LICENSE.txt */
"use strict";(wx.webpackJsonp=wx.webpackJsonp||[]).push([["pages/verification/verification"],{"./node_modules/@tarojs/taro-loader/lib/raw.js!./src/pages/verification/verification.vue":function(e,t,n){var o=n("./src/pages/verification/verification.vue?vue&type=template&id=01cd8c3b&ts=true"),i=n("./src/pages/verification/verification.vue?vue&type=script&setup=true&lang=ts"),s=n("./src/pages/verification/verification.vue?vue&type=style&index=0&id=01cd8c3b&lang=scss&module=true"),a=n("./node_modules/vue-loader/dist/exportHelper.js");const r={};r.$style=s.default;const l=(0,a.default)(i.default,[["render",o.render],["__cssModules",r],["__file","src/pages/verification/verification.vue"]]);t.default=l},"./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/pages/verification/verification.vue?vue&type=script&setup=true&lang=ts":function(e,t,n){var o=n("./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js"),i=n("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),s=n("./node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js"),a=n("./node_modules/vue/index.js"),r=n("./src/api/missions.ts"),l=n("./src/api/uicode.ts"),c=n("./src/components/BackgroundImage/BackgroundImage.vue"),u=n("./src/components/LottieView/LottieView.vue"),d=n("./src/components/PopLogin/PopLogin.vue"),v=n("./src/constants/index.ts"),f=n("./src/dto/events.ts"),m=n("./src/hook/useLoginPop.ts"),p=n("./src/stores/index.ts"),_=n("./src/utils/index.ts"),g=n("./src/utils/track/config.ts"),k=n("./node_modules/@tarojs/taro/index.js"),y=n.n(k),b=n("./node_modules/date-fns/esm/format/index.js");t.default=(0,a.defineComponent)({__name:"verification",setup:function setup(e,t){(0,t.expose)();var w=(0,k.getApp)()["".concat("zippo")],x=(0,g.getRefererPath)(),C=(0,k.useRouter)(),S=(0,p.useMissionsStore)(),h=(0,m.default)(),j=h.visible,E=h.target,I=h.onRegisterEvent,N=h.offRegisterEvent,L=h.checkMemberLevel,T=(0,a.ref)(""),V=(0,a.ref)(!1),B=(0,a.ref)(),R=(0,a.ref)(!1),P=(0,a.computed)((function(){var e,t,o=S.missionsUicode;if(null!==(e=B.value)&&void 0!==e&&e.record&&B.value.records.length&&(null===(t=B.value)||void 0===t?void 0:t.record.enUserId)===B.value.records[0].enUserId&&z){var i=o.find((function(e){return"填写购买目的"===e.name}));if(null!=i&&i.name){var s,a;i.status=null!==(s=z.value)&&void 0!==s&&s.completed?0:1,i.btnText=null!==(a=z.value)&&void 0!==a&&a.completed?"已领取":"去填写"}else{var r,l,c,u=o.findIndex((function(e){return e.code===v.MISSIONS_CODE.userinfo}));o.splice(u<=0?0:u+1,0,{id:v.EMissionCode.FILL_BUY_PURPOSE,icon:n("./src/static/icon/mission.png"),name:"填写购买目的",type:_.LinkType.path,url:"/packageA/pages/verifyFinishInfo/verifyFinishInfo",status:null!==(r=z.value)&&void 0!==r&&r.completed?0:1,btnText:null!==(l=z.value)&&void 0!==l&&l.completed?"已领取":"去填写",rewardValue:(null===(c=z.value)||void 0===c?void 0:c.points)||0,sort:0})}}return o})),M=(0,a.computed)((function(){var e,t,n,o;return Boolean((null===(e=B.value)||void 0===e?void 0:e.record)&&(null===(t=B.value)||void 0===t?void 0:t.records.length)&&(null===(n=B.value)||void 0===n?void 0:n.records[0].id)===(null===(o=B.value)||void 0===o?void 0:o.record.id))})),$=(0,a.computed)((function(){return B.value?B.value.records.slice(0,5):[]})),F=(0,a.computed)((function(){var e,t;if(M.value)return null===(e=B.value)||void 0===e||null===(t=e.missions)||void 0===t?void 0:t.find((function(e){return e.code===v.EMissionCode.VERIFICATION_FIRST&&e.completed}))})),z=(0,a.computed)((function(){var e,t;return null===(e=B.value)||void 0===e||null===(t=e.missions)||void 0===t?void 0:t.find((function(e){return e.code===v.EMissionCode.FILL_BUY_PURPOSE}))})),D=(0,a.computed)((function(){var e;return"此防伪码".concat(M.value?"首次":"第 ".concat(null===(e=B.value)||void 0===e?void 0:e.total," 次"),"被验证")})),O=(0,a.computed)((function(){var e;return((null===(e=B.value)||void 0===e?void 0:e.records.length)||0)>5})),U=function verifyFinishListener(e){var t;if(console.debug("".concat(v.TARGET_VERIFY_FINISH," data="),e),null!==(t=B.value)&&void 0!==t&&t.missions){var n,o=(0,s.default)(B.value.missions);try{for(o.s();!(n=o.n()).done;){var i=n.value;if(i.code===v.EMissionCode.FILL_BUY_PURPOSE){i.completed=!0;break}}}catch(e){o.e(e)}finally{o.f()}var a=P.value.find((function(e){return"填写购买目的"===e.name}));(null==a?void 0:a.name)&&G(a,"系统自动发放")}};function load(){return _load.apply(this,arguments)}function _load(){return(_load=(0,i.default)((0,o.default)().mark((function _callee3(){var e;return(0,o.default)().wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=T.value)){t.next=13;break}return t.prev=2,t.next=5,(0,l.uicodeVerify)({cipher:e});case 5:B.value=t.sent,V.value=!0,q(),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),console.error(t.t0);case 13:B.value||(5e3,(0,_.Toast)({title:"请扫描正确的二维码",duration:5e3}),setTimeout((function(){return y().switchTab({url:"/pages/index/index"})}),5e3));case 14:case"end":return t.stop()}}),_callee3,null,[[2,10]])})))).apply(this,arguments)}function handleQrcodeScene(){var e=C.params,t=e.scene,n=void 0===t?"":t,o=e.q,i=void 0===o?"":o,s="";if(n&&(s=decodeURIComponent(n)),i){var a=((i.split("?")||[])[1]||"").split("=")[1]||"";a&&(s=decodeURIComponent(a))}if(s)return s}(0,a.onMounted)((0,i.default)((0,o.default)().mark((function _callee(){var e,t;return(0,o.default)().wrap((function _callee$(n){for(;;)switch(n.prev=n.next){case 0:if(V.value=!1,t=handleQrcodeScene(),T.value=(null===(e=y().getCurrentInstance().preloadData)||void 0===e?void 0:e.code)||t||"",I(),(0,p.useUserStore)().isMemberLevel&&(0,p.useUserStore)().isPhone){n.next=8;break}L(v.LOGIN_TARGET.verificationCode,load),n.next=10;break;case 8:return n.next=10,load();case 10:y().eventCenter.on(v.TARGET_VERIFY_FINISH,U);case 11:case"end":return n.stop()}}),_callee)})))),(0,k.useDidShow)((function(){S.load()})),(0,a.onUnmounted)((function(){y().preload({}),y().eventCenter.off(v.TARGET_VERIFY_FINISH,U),N()}));var A=function(){var e=(0,i.default)((0,o.default)().mark((function _callee2(e){var t,n;return(0,o.default)().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:if(t=e.id){o.next=3;break}return o.abrupt("return");case 3:return R.value=!0,o.prev=4,o.next=7,(0,r.getMissionsRewardsApi)(t);case 7:return n=o.sent,console.debug("handleRewards: ",n),e.status=0,e.btnText="已领取",o.next=13,(0,p.usePointStore)().load();case 13:(0,_.Toast)("领取成功，小火苗+".concat(n.rewardValue)),G(e),Q(e,"已完成"),o.next=21;break;case 18:o.prev=18,o.t0=o.catch(4),(0,_.Toast)(o.t0.message);case 21:return o.prev=21,R.value=!1,o.finish(21);case 24:case"end":return o.stop()}}),_callee2,null,[[4,18,21,24]])})));return function handleRewards(t){return e.apply(this,arguments)}}();var q=function onTrack(){var e,t,n,o,i;w&&w.track({event:f.ELinkflowEventsName.QRCodeVerification_Submit,props:{skuId:null===(e=B.value)||void 0===e||null===(t=e.product)||void 0===t?void 0:t.barcode,outerSkuId:null===(n=B.value)||void 0===n||null===(o=n.product)||void 0===o?void 0:o.code,channelId:null===(i=B.value)||void 0===i?void 0:i.distributor.code,isFirstVerify:M.value,isFirstVerifyUser:M.value,verifyId:T.value,triggerPagePath:x}})},Q=function onTaskClickTrack(e,t){w&&w.track({event:f.ELinkflowEventsName.InteractiveTask_Click,props:{taskName:e.name,taskId:e.id,taskStatus:t,triggerPagePath:x}})},G=function onTaskClickCompleteTrack(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"手动领取";w&&w.track({event:f.ELinkflowEventsName.InteractiveTask_Complete_ReceiveAward,props:{taskName:e.name,taskId:e.id,receiveWay:t,triggerPagePath:x}})},H={linkflow:w,triggerPagePath:x,router:C,missionsStore:S,showLoginPop:j,loginTarget:E,onRegisterEvent:I,offRegisterEvent:N,checkMemberLevel:L,verifyCode:T,isLoaded:V,qrData:B,btnLoading:R,taskList:P,isFirstQr:M,records:$,firstTimeMission:F,buyPurposeMission:z,verifyMessage:D,isExceedMaxLen:O,verifyFinishListener:U,load:load,handleQrcodeScene:handleQrcodeScene,handleRewards:A,gotoPage:function gotoPage(e){if("联系客服获取更多小火苗"===e.name)return(0,_.openCustomerServiceChat)();if("领取"===e.btnText)return A(e);if(Q(e,"待完成"),e.url){var t;if("填写购买目的"===e.name)e.url="".concat(e.url,"?cipher=").concat(T.value,"&product=").concat(encodeURIComponent(JSON.stringify(null===(t=B.value)||void 0===t?void 0:t.product)));(0,_.handleLink)(e.type,e.url)}},onTrack:q,onTaskClickTrack:Q,onTaskClickCompleteTrack:G,BackgroundImage:c.default,LottieView:u.default,PopLogin:d.default,get MISSIONS_CODE(){return v.MISSIONS_CODE},get format(){return b.default}};return Object.defineProperty(H,"__isScriptSetup",{enumerable:!1,value:!0}),H}})},"./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/templateLoader.js??ruleSet[1].rules[3]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/pages/verification/verification.vue?vue&type=template&id=01cd8c3b&ts=true":function(e,t,n){n.d(t,{render:function(){return render}});var o=n("./node_modules/@nutui/nutui-taro/dist/packages/button/index.mjs"),i=(n("./node_modules/@nutui/nutui-taro/dist/packages/button/style.mjs"),n("./src/components/CustomBar/CustomBar.vue")),s=n("./node_modules/vue/index.js"),a=(0,s.createElementVNode)("text",{class:"f_s-20"},"ZIPPO 官方正品防伪码",-1),r=["src"],l=["src"],c={class:"f_s-16"};function render(e,t,n,u,d,v){var f=i.default,m=o.Button;return(0,s.openBlock)(),(0,s.createBlock)(u.BackgroundImage,{class:(0,s.normalizeClass)(e.$style.layout)},{default:(0,s.withCtx)((function(){var n;return[(0,s.createCommentVNode)(' <view class="container" :class="$style.layout"> '),(0,s.createVNode)(u.PopLogin,{"is-show":u.showLoginPop,"onUpdate:isShow":t[0]||(t[0]=function(e){return u.showLoginPop=e}),target:u.loginTarget,"close-on-click-overlay":!1,closeable:!1,"z-index":"1999"},null,8,["is-show","target"]),(0,s.createVNode)(f,{title:"防伪验真"}),u.isLoaded?((0,s.openBlock)(),(0,s.createElementBlock)("view",{key:0,class:(0,s.normalizeClass)([e.$style.main,"nut-flex-col nut-row-center nut-col-top"])},[(0,s.createElementVNode)("view",{class:(0,s.normalizeClass)([e.$style.title,"nut-flex-col nut-row-center nut-col-center"])},[(0,s.createVNode)(u.LottieView,{key:"verifySuccess",class:(0,s.normalizeClass)(e.$style.icon_success),autoplay:!0,loop:!1,"assets-path":"static/success3.json",config:{width:48,height:48}},null,8,["class"]),a],2),null!==(n=u.qrData)&&void 0!==n&&n.product?((0,s.openBlock)(),(0,s.createElementBlock)("view",{key:0,class:(0,s.normalizeClass)([e.$style.goods,"nut-flex-col nut-row-center nut-col-center"])},[(0,s.createElementVNode)("text",null,(0,s.toDisplayString)(u.qrData.product.name),1),u.qrData.product.qrPhoto?((0,s.openBlock)(),(0,s.createElementBlock)("image",{key:0,class:(0,s.normalizeClass)(e.$style.image),src:u.qrData.product.qrPhoto},null,10,r)):(0,s.createCommentVNode)("v-if",!0)],2)):(0,s.createCommentVNode)("v-if",!0),(0,s.createElementVNode)("view",{class:(0,s.normalizeClass)(e.$style.info)},[(0,s.createElementVNode)("view",{class:(0,s.normalizeClass)(e.$style.title)},(0,s.toDisplayString)(u.verifyMessage),3),u.isExceedMaxLen?((0,s.openBlock)(),(0,s.createElementBlock)("view",{key:0,class:(0,s.normalizeClass)([[e.$style.title,e.$style.warn_tips],"f_s-14"])},"此防伪码已被验证超过5次，请您留意！",2)):(0,s.createCommentVNode)("v-if",!0),u.isFirstQr?(0,s.createCommentVNode)("v-if",!0):((0,s.openBlock)(),(0,s.createElementBlock)("view",{key:1,class:(0,s.normalizeClass)(e.$style.time)},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(u.records,(function(e,t){return(0,s.openBlock)(),(0,s.createElementBlock)("block",{key:e.id},[(0,s.createElementVNode)("view",null,"第"+(0,s.toDisplayString)(t+1)+"次验证时间："+(0,s.toDisplayString)(u.format(new Date(e.createdAt),"yyyy年MM月dd日 HH:mm")),1)])})),128))],2)),u.firstTimeMission?((0,s.openBlock)(),(0,s.createElementBlock)("view",{key:2,class:(0,s.normalizeClass)(e.$style.tips)},(0,s.toDisplayString)("首次扫描防伪码已奖励".concat(u.firstTimeMission.points,"小火苗")),3)):(0,s.createCommentVNode)("v-if",!0)],2)],2)):(0,s.createCommentVNode)("v-if",!0),u.isLoaded?((0,s.openBlock)(),(0,s.createElementBlock)("view",{key:1,class:(0,s.normalizeClass)([e.$style.footer,"nut-flex-col nut-col-center nut-row-top"])},[(0,s.createCommentVNode)(' <view :class="$style.tips">{{ tips }}</view> '),(0,s.createElementVNode)("view",{class:(0,s.normalizeClass)([e.$style.task,"nut-flex-col nut-col-center nut-row-center"])},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(u.taskList,(function(t){return(0,s.openBlock)(),(0,s.createElementBlock)("view",{class:(0,s.normalizeClass)([e.$style.list,"nut-flex nut-row-between"]),key:t.id},[(0,s.createElementVNode)("view",{class:(0,s.normalizeClass)([e.$style.left,"nut-flex nut-flex-1"])},[(0,s.createElementVNode)("image",{class:(0,s.normalizeClass)(e.$style.icon),src:t.icon},null,10,l),(0,s.createElementVNode)("text",c,(0,s.toDisplayString)(t.name),1),t.code&&t.code===u.MISSIONS_CODE.userinfo||"填写购买目的"===t.name?((0,s.openBlock)(),(0,s.createElementBlock)("view",{key:0,class:(0,s.normalizeClass)([[e.$style.tip,!t.status&&e.$style.tip_none],"nut-flex-1 f_s-12 f_w-600"])},"+"+(0,s.toDisplayString)(t.rewardValue)+" 小火苗",3)):(0,s.createCommentVNode)("v-if",!0)],2),(0,s.createVNode)(m,{class:(0,s.normalizeClass)(e.$style.btn),size:"small",type:"primary",disabled:!t.status,plain:!t.status,loading:"领取"===t.btnText&&u.btnLoading,"open-type":"联系客服获取更多小火苗"===t.name?"contact":"",onClick:function onClick(e){return u.gotoPage(t)}},{default:(0,s.withCtx)((function(){return[(0,s.createTextVNode)((0,s.toDisplayString)(t.btnText),1)]})),_:2},1032,["class","disabled","plain","loading","open-type","onClick"])],2)})),128))],2)],2)):(0,s.createCommentVNode)("v-if",!0),(0,s.createCommentVNode)(" </view> ")]})),_:1},8,["class"])}},"./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/mini-css-extract-plugin/dist/loader.js!./node_modules/@tarojs/webpack5-runner/node_modules/css-loader/dist/cjs.js??clonedRuleSet-7.use[1]!./node_modules/vue-loader/dist/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-7.use[2]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??clonedRuleSet-7.use[4]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/pages/verification/verification.vue?vue&type=style&index=0&id=01cd8c3b&lang=scss&module=true":function(e,t){t.default={layout:"verification__layout___mCil_",main:"verification__main___sLt70",title:"verification__title___TERdF",icon_success:"verification__icon_success___IlJ7c",goods:"verification__goods___D6y9m",image:"verification__image___aYKvy",info:"verification__info___IRpNq",warn_tips:"verification__warn_tips___BDjBy",time:"verification__time___BGewt",tips:"verification__tips___Zrt5i",footer:"verification__footer___mFQZr",task:"verification__task___ZzKXg",list:"verification__list___spMtc",left:"verification__left___bSNrP",icon:"verification__icon___SpVkX",tip:"verification__tip___CXURK",tip_none:"verification__tip_none___kbAs9","slide-bottom":"verification__slide-bottom___qUSB1"}},"./src/pages/verification/verification.vue":function(e,t,n){var o=n("./node_modules/@tarojs/runtime/dist/runtime.esm.js"),i=n("./node_modules/@tarojs/taro-loader/lib/raw.js!./src/pages/verification/verification.vue");Page((0,o.createPageConfig)(i.default,"pages/verification/verification",{root:{cn:[]}},{}||{})),i.default},"./src/pages/verification/verification.vue?vue&type=script&setup=true&lang=ts":function(e,t,n){n.d(t,{default:function(){return o.default}});var o=n("./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/pages/verification/verification.vue?vue&type=script&setup=true&lang=ts")},"./src/pages/verification/verification.vue?vue&type=template&id=01cd8c3b&ts=true":function(e,t,n){n.d(t,{render:function(){return o.render}});var o=n("./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/templateLoader.js??ruleSet[1].rules[3]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/pages/verification/verification.vue?vue&type=template&id=01cd8c3b&ts=true")},"./src/pages/verification/verification.vue?vue&type=style&index=0&id=01cd8c3b&lang=scss&module=true":function(e,t,n){n.d(t,{default:function(){return o.default}});var o=n("./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/mini-css-extract-plugin/dist/loader.js!./node_modules/@tarojs/webpack5-runner/node_modules/css-loader/dist/cjs.js??clonedRuleSet-7.use[1]!./node_modules/vue-loader/dist/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-7.use[2]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??clonedRuleSet-7.use[4]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/pages/verification/verification.vue?vue&type=style&index=0&id=01cd8c3b&lang=scss&module=true")}},function(e){e.O(0,["taro","vendors","common"],(function(){return t="./src/pages/verification/verification.vue",e(e.s=t);var t}));e.O()}]);