/*! For license information please see pointmall.js.LICENSE.txt */
"use strict";(wx.webpackJsonp=wx.webpackJsonp||[]).push([["pages/pointmall/pointmall"],{"./node_modules/@tarojs/taro-loader/lib/raw.js!./src/pages/pointmall/pointmall.vue":function(e,t,n){var a=n("./src/pages/pointmall/pointmall.vue?vue&type=template&id=585a7fa5&ts=true"),o=n("./src/pages/pointmall/pointmall.vue?vue&type=script&setup=true&lang=ts"),l=n("./src/pages/pointmall/pointmall.vue?vue&type=style&index=1&id=585a7fa5&lang=scss&module=true"),s=n("./node_modules/vue-loader/dist/exportHelper.js");const i={};i.$style=l.default;const r=(0,s.default)(o.default,[["render",a.render],["__cssModules",i],["__file","src/pages/pointmall/pointmall.vue"]]);t.default=r},"./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/pages/pointmall/pointmall.vue?vue&type=script&setup=true&lang=ts":function(e,t,n){var a=n("./node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js"),o=n("./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js"),l=n("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),s=n("./node_modules/vue/index.js"),i=n("./src/api/daily.ts"),r=n("./src/api/points.ts"),u=n("./src/components/PopLogin/PopLogin.vue"),d=n("./src/hook/useLoginPop.ts"),c=n("./src/packageA/pages/signin/components/PopSignInResult.vue"),p=n("./src/stores/index.ts"),m=n("./src/utils/index.ts"),g=n("./src/utils/track/index.ts"),f=n("./src/utils/track/config.ts"),_=n("./node_modules/@tarojs/taro/index.js"),v=n.n(_),h=n("./node_modules/date-fns/esm/startOfMonth/index.js"),k=n("./node_modules/lodash/lodash.js"),w=n("./src/pages/mine/components/UserInfoItem.vue"),b=n("./src/pages/pointmall/components/TaskItem.vue"),S="packageA/pages/pointmall/pointmall";t.default=(0,s.defineComponent)({__name:"pointmall",setup:function setup(e,t){(0,t.expose)(),(0,s.useCssVars)((function(e){return{"585a7fa5-bgImg":L}}));var n=(0,_.getApp)()["".concat("zippo")],x=(0,f.getRefererPath)(),y=(0,d.default)(),j=y.visible,P=y.target,I=y.onRegisterEvent,N=y.offRegisterEvent,D=(0,p.useAppStore)(),E=(0,p.useMissionsStore)(),C=(0,p.useSigninStore)(),L="url(".concat((0,m.cdnurl)("static/member_bg3.png"),")"),R=(0,s.ref)(0),T=(0,s.ref)([]),B=(0,s.ref)({page:1,perPage:20,group:""}),V=(0,s.ref)(!1),$=(0,s.ref)(!1),z=(0,s.ref)([]),M=(0,s.computed)((function(){return"calc(100vh - 270px)"})),G=(0,s.computed)((function(){return E.missionsInPoint})),A=(0,s.computed)((function(){return function(e){return e.reduce((function(e,t){return t.pointMallSaleData.point<e.pointMallSaleData.point?t:e}),e[0])}}));function fetchGroups(){return _fetchGroups.apply(this,arguments)}function _fetchGroups(){return(_fetchGroups=(0,l.default)((0,o.default)().mark((function _callee3(){var e,t,n,l,s,i;return(0,o.default)().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,r.getConfigs)();case 3:e=o.sent,o.next=9;break;case 6:o.prev=6,o.t0=o.catch(0),console.error("getConfigs err=",o.t0);case 9:if(t=e.groups,B.value.group=t[0].name,!(t.length<1)){o.next=13;break}return o.abrupt("return");case 13:init(),n=(0,a.default)(t);try{for(n.s();!(l=n.n()).done;)s=l.value,i={className:s.name,id:s.id,list:[]},T.value.push(i)}catch(e){n.e(e)}finally{n.f()}case 16:case"end":return o.stop()}}),_callee3,null,[[0,6]])})))).apply(this,arguments)}function load(){return _load.apply(this,arguments)}function _load(){return(_load=(0,l.default)((0,o.default)().mark((function _callee4(){var e,t,n;return(0,o.default)().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:if(!V.value){a.next=2;break}return a.abrupt("return");case 2:return a.prev=2,a.next=5,(0,r.getPointList)(B.value);case 5:e=a.sent,a.next=11;break;case 8:a.prev=8,a.t0=a.catch(2),console.error("getPointList page load err=",a.t0);case 11:if(e){a.next=13;break}return a.abrupt("return");case 13:(t=e.list||[]).length<B.value.perPage&&(V.value=!0),n=T.value[R.value],1===B.value.page?n.list=t:n.list=n.list.concat(t),B.value.page+=1;case 18:case"end":return a.stop()}}),_callee4,null,[[2,8]])})))).apply(this,arguments)}function initPageData(){return _initPageData.apply(this,arguments)}function _initPageData(){return(_initPageData=(0,l.default)((0,o.default)().mark((function _callee5(){return(0,o.default)().wrap((function _callee5$(e){for(;;)switch(e.prev=e.next){case 0:V.value=!1,B.value.page=1;case 2:case"end":return e.stop()}}),_callee5)})))).apply(this,arguments)}function init(){return _init.apply(this,arguments)}function _init(){return(_init=(0,l.default)((0,o.default)().mark((function _callee6(){return(0,o.default)().wrap((function _callee6$(e){for(;;)switch(e.prev=e.next){case 0:return initPageData(),e.next=3,load();case 3:case"end":return e.stop()}}),_callee6)})))).apply(this,arguments)}(0,s.onMounted)((0,l.default)((0,o.default)().mark((function _callee(){return(0,o.default)().wrap((function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetchGroups();case 2:case"end":return e.stop()}}),_callee)})))),(0,_.useDidShow)((0,l.default)((0,o.default)().mark((function _callee2(){return(0,o.default)().wrap((function _callee2$(e){for(;;)switch(e.prev=e.next){case 0:return I(),e.next=3,(0,p.useSigninStore)().load((0,h.default)(new Date).toISOString());case 3:E.load(),(0,p.usePointStore)().load(),D.setShowTabbar(!0),D.setSelected(3);case 7:case"end":return e.stop()}}),_callee2)})))),(0,_.useDidHide)((function(){"android"===D.sysInfo.platform&&D.setSelected(-1),N()})),(0,_.useShareAppMessage)((function(){var e=(0,m.shareOptions)({page:"/pages/pointmall/pointmall"});return console.debug("pointmall page useShareAppMessage path=",e.path),e}));var O=function onTrack(){if(n&&T.value[R.value]){var e=T.value[R.value],t=e.className,a=void 0===t?"":t,o=e.id,l=void 0===o?"":o;n.track({event:g.ELinkflowEventsName.ProductDetail_Sort,props:{productSort:"Zippo积分商品",productSubdivide:a,productSubdivideId:l,triggerPagePath:x}})}};function _handleSignin(){return(_handleSignin=(0,l.default)((0,o.default)().mark((function _callee7(e){var t,n,a;return(0,o.default)().wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,i.getDailySigninApi)();case 3:t=o.sent,$.value=!0,z.value=t.rewards,U(e),n=new Date((new Date).getFullYear(),(new Date).getMonth(),1,0,0,0).toISOString(),(a=(0,k.cloneDeep)(C.getSigninDatas[n])).days.push({signInDate:t.signInDate,isSignIn:!0}),C.setSigninData(n,a),o.next=16;break;case 13:o.prev=13,o.t0=o.catch(0),(0,m.Toast)(o.t0.message);case 16:case"end":return o.stop()}}),_callee7,null,[[0,13]])})))).apply(this,arguments)}var U=function onTaskSignInTrack(e){if(n){var t=e.id,a=e.name;n.track({event:g.ELinkflowEventsName.InteractiveTask_Click,props:{taskName:a,taskId:"".concat(t),taskStatus:"已完成",triggerPagePath:x}}),n.track({event:g.ELinkflowEventsName.InteractiveTask_Complete_ReceiveAward,props:{taskName:a,taskId:"".concat(t),receiveWay:"手动领取",triggerPagePath:x}})}},H={linkflow:n,triggerPagePath:x,showLoginPop:j,loginTarget:P,onRegisterEvent:I,offRegisterEvent:N,path:S,appStore:D,missionsStore:E,signinStore:C,bgImg:L,tabIndex:R,productList:T,listParams:B,finished:V,showSignInResultPop:$,signinResultData:z,scrollHeight:M,taskList:G,minItem:A,scrollReachBottom:function scrollReachBottom(){load()},fetchGroups:fetchGroups,load:load,initPageData:initPageData,init:init,handleChangeTabs:function handleChangeTabs(){O(),B.value.group=T.value[R.value].className,init()},gotoGoodsDetailPage:function gotoGoodsDetailPage(e){(0,g.tarckEvents)([{path:S,event:g.IEventsName.GOODS_CL,properties:{name:e.goodsInfo.name,goodsId:+e.goodsInfo.id,desc:"进入积分商详"}}]),v().navigateTo({url:"/packageA/pages/pointGoodsDetail/pointGoodsDetail?id=".concat(e.goodsInfo.id,"&promotionId=").concat(e.promotion)})},onTrack:O,handleSignin:function handleSignin(e){return _handleSignin.apply(this,arguments)},onTaskSignInTrack:U,PopLogin:u.default,PopSignInResult:c.default,UserInfoItem:w.default,TaskItem:b.default};return Object.defineProperty(H,"__isScriptSetup",{enumerable:!1,value:!0}),H}})},"./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/templateLoader.js??ruleSet[1].rules[3]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/pages/pointmall/pointmall.vue?vue&type=template&id=585a7fa5&ts=true":function(e,t,n){n.d(t,{render:function(){return render}});var a=n("./node_modules/@nutui/nutui-taro/dist/packages/tabs/index.mjs"),o=(n("./node_modules/@nutui/nutui-taro/dist/packages/tabs/style.mjs"),n("./node_modules/@nutui/nutui-taro/dist/packages/tabpane/index.mjs")),l=(n("./node_modules/@nutui/nutui-taro/dist/packages/tabpane/style.mjs"),n("./node_modules/vue/index.js")),s={class:"nut-flex-1 nut-flex-col nut-row-left nut-col-top"},i=["onTap"],r=["src"],u=(0,l.createElementVNode)("text",{class:"f_s-14"},"小火苗",-1),d={key:0},c=(0,l.createElementVNode)("text",{class:"f_s-14"},"元",-1),p=(0,l.createElementVNode)("view",{class:"tabbar-placeholder"},null,-1);function render(e,t,n,m,g,f){var _=o.TabPane,v=a.Tabs;return(0,l.openBlock)(),(0,l.createElementBlock)("view",{class:(0,l.normalizeClass)(["container",e.$style.layout])},[(0,l.createElementVNode)("view",{class:(0,l.normalizeClass)(e.$style.user)},[(0,l.createVNode)(m.UserInfoItem,{"show-login-pop":m.showLoginPop,"onUpdate:showLoginPop":t[0]||(t[0]=function(e){return m.showLoginPop=e})},null,8,["show-login-pop"])],2),(0,l.createElementVNode)("scroll-view",{class:(0,l.normalizeClass)(e.$style.info),style:(0,l.normalizeStyle)({height:m.scrollHeight}),"scroll-y":!0,enhanced:!0,"enable-passive":!0,"scroll-with-animation":!0,"show-scrollbar":!1,onScrolltolower:m.scrollReachBottom},[(0,l.createElementVNode)("view",{class:(0,l.normalizeClass)([e.$style.main,"nut-flex-1 nut-flex-col"])},[m.taskList.length>0?((0,l.openBlock)(),(0,l.createElementBlock)("view",{key:0,class:(0,l.normalizeClass)(e.$style.main_task)},[(0,l.createElementVNode)("view",{class:(0,l.normalizeClass)([e.$style.title,"f_s-16"])},"今日任务",2),(0,l.createElementVNode)("view",s,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(m.taskList,(function(e){return(0,l.openBlock)(),(0,l.createBlock)(m.TaskItem,{"show-login-pop":m.showLoginPop,"onUpdate:showLoginPop":t[1]||(t[1]=function(e){return m.showLoginPop=e}),key:e.id,task:e,onSiginIn:m.handleSignin},null,8,["show-login-pop","task"])})),128))])],2)):(0,l.createCommentVNode)("v-if",!0),m.productList.length>0?((0,l.openBlock)(),(0,l.createElementBlock)("view",{key:1,class:(0,l.normalizeClass)(e.$style.tasb)},[(0,l.createVNode)(v,{class:"pointmall_tabs",modelValue:m.tabIndex,"onUpdate:modelValue":t[2]||(t[2]=function(e){return m.tabIndex=e}),"title-scroll":"",name:"tabName",size:"large","auto-height":"",onChange:m.handleChangeTabs},{default:(0,l.withCtx)((function(){return[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(m.productList,(function(t,n){return(0,l.openBlock)(),(0,l.createElementBlock)("block",{key:n},[(0,l.createVNode)(_,{title:t.className,"pane-key":n},{default:(0,l.withCtx)((function(){return[(0,l.createElementVNode)("view",{class:(0,l.normalizeClass)([e.$style.goods,"nut-flex nut-flex-wrap nut-row-between nut-col-top"])},[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(t.list,(function(t){return(0,l.openBlock)(),(0,l.createElementBlock)("view",{class:(0,l.normalizeClass)([e.$style.goods_list,"nut-flex-col nut-row-left nut-col-top"]),onTap:function onTap(e){return m.gotoGoodsDetailPage(t)},key:t.goodsInfo.id},[(0,l.createElementVNode)("image",{class:(0,l.normalizeClass)([e.$style.image,"border-05px-box-0"]),src:t.goodsInfo.image,mode:"aspectFill"},null,10,r),(0,l.createElementVNode)("view",{class:(0,l.normalizeClass)(["nut-flex-1 nut-line-1 f_s-14",e.$style.name])},(0,l.toDisplayString)(t.goodsInfo.name),3),(0,l.createElementVNode)("view",{class:(0,l.normalizeClass)(["nut-flex-1 nut-line-2 nut-flex nut-row-left nut-col-baseline",e.$style.point_box])},[(0,l.createElementVNode)("text",{class:(0,l.normalizeClass)(["f_w-500 numfnt-medium",e.$style.point])},(0,l.toDisplayString)(m.minItem(t.goodsInfo.skus).pointMallSaleData.point),3),u,m.minItem(t.goodsInfo.skus).pointMallSaleData.price>0?((0,l.openBlock)(),(0,l.createElementBlock)("block",d,[(0,l.createElementVNode)("text",{class:(0,l.normalizeClass)(["f_w-500 numfnt-medium",e.$style.point])}," + "+(0,l.toDisplayString)(m.minItem(t.goodsInfo.skus).pointMallSaleData.price),3),c])):(0,l.createCommentVNode)("v-if",!0)],2)],42,i)})),128))],2)]})),_:2},1032,["title","pane-key"])])})),128))]})),_:1},8,["modelValue"])],2)):(0,l.createCommentVNode)("v-if",!0),p],2)],38),(0,l.createVNode)(m.PopLogin,{"is-show":m.showLoginPop,"onUpdate:isShow":t[3]||(t[3]=function(e){return m.showLoginPop=e}),target:m.loginTarget},null,8,["is-show","target"]),(0,l.createVNode)(m.PopSignInResult,{show:m.showSignInResultPop,"onUpdate:show":t[4]||(t[4]=function(e){return m.showSignInResultPop=e}),rewards:m.signinResultData,"show-detail-btn":!0},null,8,["show","rewards"])],2)}},"./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/mini-css-extract-plugin/dist/loader.js!./node_modules/@tarojs/webpack5-runner/node_modules/css-loader/dist/cjs.js??clonedRuleSet-7.use[1]!./node_modules/vue-loader/dist/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-7.use[2]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??clonedRuleSet-7.use[4]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/pages/pointmall/pointmall.vue?vue&type=style&index=1&id=585a7fa5&lang=scss&module=true":function(e,t){t.default={layout:"pointmall__layout___f8Qr9",user:"pointmall__user___yQ6NM",info:"pointmall__info___wHwzX",main:"pointmall__main___vHenB",main_task:"pointmall__main_task___oiCQz",title:"pointmall__title___xBCsm",goods:"pointmall__goods___Sg5QY",goods_list:"pointmall__goods_list___YgHIj",point_box:"pointmall__point_box____ZXZ3",image:"pointmall__image___TGDgM",name:"pointmall__name___DMlKS",point:"pointmall__point___rtSYO","slide-bottom":"pointmall__slide-bottom___PpaSU"}},"./src/pages/pointmall/pointmall.vue":function(e,t,n){var a=n("./node_modules/@tarojs/runtime/dist/runtime.esm.js"),o=n("./node_modules/@tarojs/taro-loader/lib/raw.js!./src/pages/pointmall/pointmall.vue");o.default.enableShareAppMessage=!0;Page((0,a.createPageConfig)(o.default,"pages/pointmall/pointmall",{root:{cn:[]}},{navigationBarTextStyle:"white",enableShareAppMessage:!0,usingComponents:{},disableScroll:!0}||{})),o.default},"./src/pages/pointmall/pointmall.vue?vue&type=script&setup=true&lang=ts":function(e,t,n){n.d(t,{default:function(){return a.default}});var a=n("./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/pages/pointmall/pointmall.vue?vue&type=script&setup=true&lang=ts")},"./src/pages/pointmall/pointmall.vue?vue&type=template&id=585a7fa5&ts=true":function(e,t,n){n.d(t,{render:function(){return a.render}});var a=n("./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/templateLoader.js??ruleSet[1].rules[3]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/pages/pointmall/pointmall.vue?vue&type=template&id=585a7fa5&ts=true")},"./src/pages/pointmall/pointmall.vue?vue&type=style&index=1&id=585a7fa5&lang=scss&module=true":function(e,t,n){n.d(t,{default:function(){return a.default}});var a=n("./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/mini-css-extract-plugin/dist/loader.js!./node_modules/@tarojs/webpack5-runner/node_modules/css-loader/dist/cjs.js??clonedRuleSet-7.use[1]!./node_modules/vue-loader/dist/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-7.use[2]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??clonedRuleSet-7.use[4]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/pages/pointmall/pointmall.vue?vue&type=style&index=1&id=585a7fa5&lang=scss&module=true")}},function(e){e.O(0,["taro","vendors","common"],(function(){return t="./src/pages/pointmall/pointmall.vue",e(e.s=t);var t}));e.O()}]);