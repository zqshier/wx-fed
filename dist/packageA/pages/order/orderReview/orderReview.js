"use strict";require("../../../sub-vendors.js");/*! For license information please see orderReview.js.LICENSE.txt */
(wx.webpackJsonp=wx.webpackJsonp||[]).push([["packageA/pages/order/orderReview/orderReview"],{"./node_modules/@tarojs/taro-loader/lib/raw.js!./src/packageA/pages/order/orderReview/orderReview.vue":function(e,t,o){var r=o("./src/packageA/pages/order/orderReview/orderReview.vue?vue&type=template&id=d8ec9c94&ts=true"),a=o("./src/packageA/pages/order/orderReview/orderReview.vue?vue&type=script&setup=true&lang=ts"),n=o("./src/packageA/pages/order/orderReview/orderReview.vue?vue&type=style&index=0&id=d8ec9c94&lang=scss&module=true"),s=o("./node_modules/vue-loader/dist/exportHelper.js");const d={};d.$style=n.default;const l=(0,s.default)(a.default,[["render",r.render],["__cssModules",d],["__file","src/packageA/pages/order/orderReview/orderReview.vue"]]);t.default=l},"./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/packageA/pages/order/orderReview/orderReview.vue?vue&type=script&setup=true&lang=ts":function(e,t,o){var r=o("./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js"),a=o("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),n=o("./node_modules/vue/index.js"),s=o("./src/api/order.ts"),d=o("./src/components/BackgroundImage/BackgroundImage.vue"),l=o("./src/components/CustomBar/CustomBar.vue"),i=o("./src/components/Loading/Loading.vue"),u=o("./src/components/OrderItem/OrderBox.vue"),c=o("./src/dto/order.ts"),m=o("./src/dto/settle.ts"),p=o("./src/utils/track/index.ts"),v=o("./src/utils/track/config.ts"),_=o("./node_modules/@tarojs/taro/index.js"),g=o.n(_),f=o("./node_modules/lodash/lodash.js"),w=o("./src/packageA/components/Rate/Rate.vue"),k="pages/order/orderReview/orderReview";t.default=(0,n.defineComponent)({__name:"orderReview",setup:function setup(e,t){(0,t.expose)();var o=(0,_.getApp)()["".concat("zippo")],b=(0,v.getRefererPath)(),R=Array.from({length:11},(function(e,t){return t})),y=(0,_.useRouter)(),S=y.params.orderNo||"",j=y.params.type||"",x=g().getCurrentInstance().preloadData||{},I=x.goodsData,C=(0,n.ref)(!1),N=[{title:"产品满意度",value:0,name:"productStar"},{title:"包装满意度",value:0,name:"productPackagingStar"},{title:"客服满意度",value:0,name:"customerServiceStar"},{title:"物流满意度",value:0,name:"logisticsStar"}],h=(0,n.ref)([]),B=(0,n.ref)({orderNo:S,items:[]}),A=(0,n.ref)(!1),P=(0,n.computed)((function(){return h.value.some((function(e){return-1===e.recommendationStar||e.rateList.some((function(e){return 0===e.value}))}))})),E=(0,n.computed)((function(){return j!==c.OrderCommentStatus.default}));var V=function(){var e=(0,a.default)((0,r.default)().mark((function _callee(){var e;return(0,r.default)().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,s.getCommentApi)(S);case 3:e=t.sent,t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.error("getCommentApi error=",t.t0);case 9:if(e){t.next=11;break}return t.abrupt("return");case 11:e.map((function(e){var t=h.value.find((function(t){return t.goodsInfo.skuId===e.skuId}));t&&(t.rateList.map((function(t){var o=t.name;Object.prototype.hasOwnProperty.call(e,o)&&(t.value=e[o])})),t.recommendationStar=e.recommendationStar)}));case 12:case"end":return t.stop()}}),_callee,null,[[0,6]])})));return function getComment(){return e.apply(this,arguments)}}();function _submitComment(){return(_submitComment=(0,a.default)((0,r.default)().mark((function _callee3(){var e,t;return(0,r.default)().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return e=[],h.value.map((function(t){var o={goodsId:0,skuId:0,productStar:0,productPackagingStar:0,customerServiceStar:0,logisticsStar:0,recommendationStar:-1};t.rateList.map((function(e){var t=e.name,r=e.value;Object.prototype.hasOwnProperty.call(o,t)&&(o[t]=r)})),o.skuId=t.goodsInfo.skuId,o.goodsId=t.goodsInfo.goodsId,o.recommendationStar=t.recommendationStar,e.push(o)})),B.value.items=e,console.log("combinedData: ",e),A.value=!0,o.prev=5,o.next=8,(0,s.commentApi)(B.value);case 8:t=o.sent,o.next=14;break;case 11:o.prev=11,o.t0=o.catch(5),console.error("commentApi error=",o.t0);case 14:return o.prev=14,A.value=!1,o.finish(14);case 17:if(t){o.next=19;break}return o.abrupt("return");case 19:D(),g().preload({type:m.FINISH_TYPE.orderDetails,orderNo:S,title:"提交成功",tips:"感谢您宝贵的建议"}),g().redirectTo({url:"/packageA/pages/finish/finish"});case 22:case"end":return o.stop()}}),_callee3,null,[[5,11,14,17]])})))).apply(this,arguments)}function initialData(){I.map((function(e){var t={goodsInfo:e,rateList:(0,f.cloneDeep)(N),recommendationStar:-1};h.value.push(t)})),C.value=!0}(0,n.onMounted)((0,a.default)((0,r.default)().mark((function _callee2(){return(0,r.default)().wrap((function _callee2$(e){for(;;)switch(e.prev=e.next){case 0:if(initialData(),j!==c.OrderCommentStatus.comment){e.next=4;break}return e.next=4,V();case 4:case"end":return e.stop()}}),_callee2)}))));var D=function onTrack(){o&&B.value.items.forEach((function(e){var t,r=null===(t=h.value.find((function(t){return"".concat(t.goodsInfo.goodsId,"-").concat(t.goodsInfo.skuId)==="".concat(e.goodsId,"-").concat(e.skuId)})))||void 0===t?void 0:t.goodsInfo;null!=r&&r.id&&o.track({event:p.ELinkflowEventsName.OrderDetail_Comment_Submit,props:{productName:r.goodsInfo.name,skuId:r.goodsInfo.skuBarCode,outerSkuId:r.goodsInfo.skuSn,miniSkuId:"".concat(r.skuId),price:+r.mktPrice||r.mktPrice,itemTotalPrice:+r.totalPrice||r.totalPrice,quantity:r.count,itemPaymentPrice:+r.payableAmount||r.payableAmount,productSatisfaction:e.productStar,packagingSatisfaction:e.productPackagingStar,customerServiceSatisfaction:e.customerServiceStar,logisticsSatisfaction:e.logisticsStar,possibilityOfRecommendation:e.recommendationStar,orderId:B.value.orderNo,lineId:"".concat(B.value.orderNo,"-").concat(r.skuId),triggerPagePath:b}})}))},$={linkflow:o,triggerPagePath:b,path:k,scoreBarNum:R,router:y,orderNo:S,type:j,preloadData:x,goodsData:I,infoLoaded:C,rateList:N,data:h,submitParams:B,loadingSubmit:A,isSubmitDisabled:P,isReadonly:E,gotoGoodsDetailsPage:function gotoGoodsDetailsPage(e){(0,p.tarckEvents)([{path:k,event:p.IEventsName.GOODS_CL,properties:{goodsId:e.goodsId}}]),g().navigateTo({url:"/packageA/pages/goodsDetail/goodsDetail?id=".concat(e.goodsId)})},handleItemSelection:function handleItemSelection(e,t){E.value||(h.value[t].recommendationStar=e)},getComment:V,submitComment:function submitComment(){return _submitComment.apply(this,arguments)},initialData:initialData,onTrack:D,BackgroundImage:d.default,CustomBar:l.default,Loading:i.default,OrderBox:u.default,Rate:w.default};return Object.defineProperty($,"__isScriptSetup",{enumerable:!1,value:!0}),$}})},"./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/templateLoader.js??ruleSet[1].rules[3]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/packageA/pages/order/orderReview/orderReview.vue?vue&type=template&id=d8ec9c94&ts=true":function(e,t,o){o.d(t,{render:function(){return render}});var r=o("./node_modules/@nutui/nutui-taro/dist/packages/button/index.mjs"),a=(o("./node_modules/@nutui/nutui-taro/dist/packages/button/style.mjs"),o("./node_modules/@babel/runtime/helpers/esm/defineProperty.js")),n=o("./node_modules/vue/index.js"),s={key:0},d=["onTap"],l=["onTap"];function render(e,t,o,i,u,c){var m=r.Button;return(0,n.openBlock)(),(0,n.createBlock)(i.BackgroundImage,null,{default:(0,n.withCtx)((function(){return[(0,n.createVNode)(i.CustomBar,{title:"订单评价",fixed:!0}),i.infoLoaded?((0,n.openBlock)(),(0,n.createElementBlock)("view",{key:0,class:(0,n.normalizeClass)(e.$style.main)},[(0,n.createElementVNode)("view",{class:(0,n.normalizeClass)([[e.$style.title,e.$style["title-top"]],"f_s-12 f_w-400 mg-bottom-24"])},"为了不断提升品牌服务，您的评价对我们至关重要",2),i.data&&i.data.length>0?((0,n.openBlock)(),(0,n.createElementBlock)("block",s,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(i.data,(function(o,r){return(0,n.openBlock)(),(0,n.createElementBlock)("view",{class:(0,n.normalizeClass)([[e.$style.order_item],"box mg-bottom-14"]),key:o.goodsInfo.id},[(0,n.createElementVNode)("view",{class:(0,n.normalizeClass)([e.$style.title,"f_s-12 f_w-400 mg-bottom-12"])},"商品信息",2),(0,n.createElementVNode)("view",{class:(0,n.normalizeClass)(e.$style.list),onTap:function onTap(e){return i.gotoGoodsDetailsPage(o.goodsInfo)}},[(0,n.createVNode)(i.OrderBox,{data:o.goodsInfo},null,8,["data"])],42,d),(0,n.createCommentVNode)(" 商品评价 "),(0,n.createElementVNode)("view",{class:(0,n.normalizeClass)(e.$style.rating)},[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(o.rateList,(function(o){return(0,n.openBlock)(),(0,n.createElementBlock)("view",{class:(0,n.normalizeClass)([e.$style.rating_item,"nut-flex nut-row-between f_s-14 f_w-400 mg-bottom-12"]),key:o.title},[(0,n.createElementVNode)("view",{class:(0,n.normalizeClass)(e.$style.item_title)},(0,n.toDisplayString)(o.title),3),(0,n.createVNode)(i.Rate,{value:o.value,"onUpdate:value":function onUpdateValue(e){return o.value=e},isRate:i.isReadonly,"onUpdate:isRate":t[0]||(t[0]=function(e){return i.isReadonly=e})},null,8,["value","onUpdate:value","isRate"])],2)})),128))],2),(0,n.createCommentVNode)(" 推荐指数 "),(0,n.createElementVNode)("view",{class:(0,n.normalizeClass)(e.$style.score_bar)},[(0,n.createElementVNode)("view",{class:(0,n.normalizeClass)([e.$style.title,"f_s-14 f_w-600 mg-bottom-12"])},"您有多大可能将该款火机推荐给朋友或其他人？",2),(0,n.createElementVNode)("view",{class:(0,n.normalizeClass)([e.$style["score_bar-index"],"nut-flex nut-row-between mg-bottom-12"])},[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(i.scoreBarNum,(function(t){return(0,n.openBlock)(),(0,n.createElementBlock)("text",{class:(0,n.normalizeClass)([[e.$style["index-item"],(0,a.default)({},e.$style["item-select"],o.recommendationStar===t)],"numfnt nut-flex nut-row-center f_s-12 f_w-500"]),key:t,onTap:function onTap(e){return i.handleItemSelection(t,r)}},(0,n.toDisplayString)(t),43,l)})),128))],2),(0,n.createElementVNode)("view",{class:(0,n.normalizeClass)([[e.$style.title,e.$style["score_bar-ins"]],"f_s-14 f_w-400 mg-bottom-4"])},"您的评价不会被公开展示",2)],2)],2)})),128))])):(0,n.createCommentVNode)("v-if",!0),(0,n.createElementVNode)("view",{class:(0,n.normalizeClass)(e.$style.main_placeholder)},null,2)],2)):(0,n.createCommentVNode)("v-if",!0),i.isReadonly?(0,n.createCommentVNode)("v-if",!0):((0,n.openBlock)(),(0,n.createElementBlock)("view",{key:1,class:(0,n.normalizeClass)([e.$style.footer,"f_s-12 f_w-400 nut-flex nut-col-top nut-row-left footer"])},[(0,n.createVNode)(m,{disabled:i.isSubmitDisabled,class:(0,n.normalizeClass)(e.$style.btn),type:"primary",loading:i.loadingSubmit,onClick:i.submitComment},{default:(0,n.withCtx)((function(){return[(0,n.createTextVNode)("提交")]})),_:1},8,["disabled","class","loading"])],2)),(0,n.createVNode)(i.Loading,{show:!i.infoLoaded},null,8,["show"])]})),_:1})}},"./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/mini-css-extract-plugin/dist/loader.js!./node_modules/@tarojs/webpack5-runner/node_modules/css-loader/dist/cjs.js??clonedRuleSet-7.use[1]!./node_modules/vue-loader/dist/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-7.use[2]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??clonedRuleSet-7.use[4]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/packageA/pages/order/orderReview/orderReview.vue?vue&type=style&index=0&id=d8ec9c94&lang=scss&module=true":function(e,t){t.default={main:"orderReview__main___iK2Df","title-top":"orderReview__title-top___n7fdk",order_item:"orderReview__order_item___pv7zn",list:"orderReview__list___rVNmp",title:"orderReview__title___fGGRI",rating:"orderReview__rating___gTtpC",rating_item:"orderReview__rating_item___XGx4I",item_title:"orderReview__item_title___iAY1N","score_bar-index":"orderReview__score_bar-index___WrrFV","index-item":"orderReview__index-item___tjB5K","item-select":"orderReview__item-select___O06ce","score_bar-ins":"orderReview__score_bar-ins___kJCIE",main_placeholder:"orderReview__main_placeholder___aRlVo",footer:"orderReview__footer___EtZjH",btn:"orderReview__btn___e3wIg","slide-bottom":"orderReview__slide-bottom___tvYFr"}},"./src/packageA/pages/order/orderReview/orderReview.vue":function(e,t,o){var r=o("./node_modules/@tarojs/runtime/dist/runtime.esm.js"),a=o("./node_modules/@tarojs/taro-loader/lib/raw.js!./src/packageA/pages/order/orderReview/orderReview.vue");Page((0,r.createPageConfig)(a.default,"packageA/pages/order/orderReview/orderReview",{root:{cn:[]}},{}||{})),a.default},"./src/packageA/pages/order/orderReview/orderReview.vue?vue&type=script&setup=true&lang=ts":function(e,t,o){o.d(t,{default:function(){return r.default}});var r=o("./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/packageA/pages/order/orderReview/orderReview.vue?vue&type=script&setup=true&lang=ts")},"./src/packageA/pages/order/orderReview/orderReview.vue?vue&type=template&id=d8ec9c94&ts=true":function(e,t,o){o.d(t,{render:function(){return r.render}});var r=o("./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/templateLoader.js??ruleSet[1].rules[3]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/packageA/pages/order/orderReview/orderReview.vue?vue&type=template&id=d8ec9c94&ts=true")},"./src/packageA/pages/order/orderReview/orderReview.vue?vue&type=style&index=0&id=d8ec9c94&lang=scss&module=true":function(e,t,o){o.d(t,{default:function(){return r.default}});var r=o("./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/mini-css-extract-plugin/dist/loader.js!./node_modules/@tarojs/webpack5-runner/node_modules/css-loader/dist/cjs.js??clonedRuleSet-7.use[1]!./node_modules/vue-loader/dist/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-7.use[2]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??clonedRuleSet-7.use[4]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/packageA/pages/order/orderReview/orderReview.vue?vue&type=style&index=0&id=d8ec9c94&lang=scss&module=true")}},function(e){e.O(0,["packageA/sub-vendors","taro","vendors","common"],(function(){return t="./src/packageA/pages/order/orderReview/orderReview.vue",e(e.s=t);var t}));e.O()}]);