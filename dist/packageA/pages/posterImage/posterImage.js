"use strict";require("../../sub-vendors.js");/*! For license information please see posterImage.js.LICENSE.txt */
(wx.webpackJsonp=wx.webpackJsonp||[]).push([["packageA/pages/posterImage/posterImage"],{"./src/packageA/pages/posterImage/card.ts":function(e,s,o){o.d(s,{default:function(){return c}});var t=o("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=o("./node_modules/@babel/runtime/helpers/esm/createClass.js"),n=o("./node_modules/@tarojs/taro/index.js"),r=o.n(n),u=o("./src/scss/variables.ts"),l="FZLanTingHei-R-GBK",d=r().getSystemInfoSync().screenWidth>375?1.5:2,i=function pxTransform(e){var s=(0,n.pxTransform)(e*d);return parseInt(s)},c=function(){function LastMayday(){(0,t.default)(this,LastMayday)}return(0,a.default)(LastMayday,[{key:"palette",value:function palette(e,s){return{width:i(375),height:i(676),backgroundColor:u.default.white,debug:!1,images:[{url:e.shareImage||e.image,width:i(375),height:i(562),x:i(0),y:i(0)},{url:s,width:i(64),height:i(64),y:i(588),x:i(290)}],texts:[{text:"长按识别二维码",fontSize:i(16),fontWeight:"400",color:u.default.primaryColor,y:i(601),x:i(24),zIndex:2,fontFamily:l},{text:"即刻选购",fontSize:i(16),fontWeight:"400",color:u.default.primaryColor,y:i(622),x:i(24),zIndex:2,fontFamily:l}]}}}]),LastMayday}()},"./node_modules/@tarojs/taro-loader/lib/raw.js!./src/packageA/pages/posterImage/posterImage.vue":function(e,s,o){var t=o("./src/packageA/pages/posterImage/posterImage.vue?vue&type=template&id=379b6607&ts=true"),a=o("./src/packageA/pages/posterImage/posterImage.vue?vue&type=script&setup=true&lang=ts"),n=o("./src/packageA/pages/posterImage/posterImage.vue?vue&type=style&index=0&id=379b6607&lang=scss&module=true"),r=o("./node_modules/vue-loader/dist/exportHelper.js");const u={};u.$style=n.default;const l=(0,r.default)(a.default,[["render",t.render],["__cssModules",u],["__file","src/packageA/pages/posterImage/posterImage.vue"]]);s.default=l},"./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/packageA/pages/posterImage/posterImage.vue?vue&type=script&setup=true&lang=ts":function(e,s,o){var t=o("./node_modules/vue/index.js"),a=o("./src/components/BackgroundImage/BackgroundImage.vue"),n=o("./src/components/CustomBar/props.ts"),r=o("./src/components/PosterBuilder/index.vue"),u=o("./src/dto/point.ts"),l=o("./src/stores/index.ts"),d=o("./src/utils/index.ts"),i=o("./src/utils/http/index.ts"),c=o("./src/utils/track/index.ts"),p=o("./node_modules/@tarojs/taro/index.js"),m=o.n(p),g=o("./src/packageA/pages/posterImage/card.ts"),v="scope.writePhotosAlbum";s.default=(0,t.defineComponent)({__name:"posterImage",setup:function setup(e,s){(0,s.expose)();var o=(0,p.getCurrentInstance)().preloadData||{},f=(0,t.ref)(o.type||""),_=(0,t.ref)(""),I=(0,t.computed)((function(){return o.goodsInfo})),k=(0,t.computed)((function(){return o.pointsGoodsInfo})),y=(0,t.computed)((function(){return o.cSkusData})),j=(0,t.computed)((function(){return f.value===u.posterSource.normalGoods})),b=(0,t.reactive)({startDraw:!1,config:{width:750,height:1352}}),x=function handleCreatePainter(){var e,s,o,t,a,n={id:null===(e=I.value)||void 0===e?void 0:e.id,uid:(null===(s=(0,l.useUserStore)().getUserInfo)||void 0===s?void 0:s.sid)||""};j.value||(n.id=null===(o=k.value)||void 0===o?void 0:o.goodsInfo.id,n.promotionId=null===(t=k.value)||void 0===t?void 0:t.promotionId);try{a=(0,i.getQrCodeUrl)({page:j.value?"packageA/pages/goodsDetail/goodsDetail":"packageA/pages/pointGoodsDetail/pointGoodsDetail",params:n})}catch(e){(0,d.Toast)("网络错误,请重试",2e3,"none",!0,(function(){setTimeout((function(){m().navigateBack()}),1500)}))}if(a){var r=j.value?I.value:k.value,u=(new g.default).palette(r,a);b.config=u,b.startDraw=!0}},h=function authConfirm(){m().showModal({content:"检测到您没打开保存图片权限，是否去设置打开？",confirmText:"确认",cancelText:"取消",success:function success(e){e.confirm?m().openSetting({success:function success(e){e.authSetting[v]?S():(0,d.Toast)("您没有授权，无法保存到相册")}}):(0,d.Toast)("您没有授权，无法保存到相册")}})},S=function saveImage(){var e,s,o="packageA/pages/posterImage/posterImage",t=null===(e=I.value)||void 0===e?void 0:e.id,a=null===(s=y.value)||void 0===s?void 0:s.id;m().saveImageToPhotosAlbum({filePath:_.value,success:function success(e){console.log("saveImg res=",e),(0,c.tarckEvents)([{path:o,event:c.IEventsName.POSTER_CL,properties:{goodsId:t,skuId:a,status:1}}]),(0,d.Toast)("保存成功~")},fail:function fail(e){console.log("saveImg err=",e),(0,c.tarckEvents)([{path:o,event:c.IEventsName.POSTER_CL,properties:{goodsId:t,skuId:a,status:0}}]),(0,d.Toast)("保存失败~")},complete:function complete(){m().vibrateShort()}})};(0,t.onMounted)((function(){x()})),(0,t.onUnmounted)((function(){m().preload({})}));var w={routerInfo:o,type:f,SCOPE_WRITE_PHOTOS_ABLUM:v,get image(){return _},set image(e){_=e},goodsInfo:I,pointsGoodsInfo:k,currentSkusData:y,isNormalGoods:j,data:b,handleCreatePainter:x,savePoster:function savePoster(){m().getSetting({success:function success(e){e.authSetting[v]?S():void 0===e.authSetting[v]?m().authorize({scope:v,success:function success(){S()},fail:function fail(){h()}}):h()}})},authConfirm:h,onImgOk:function onImgOk(e){_.value=e.tempFilePath,b.startDraw=!1},onImgError:function onImgError(e){console.error("onImgError error=",e)},saveImage:S,BackgroundImage:a.default,get LogoColorType(){return n.LogoColorType},PosterBuilder:r.default,get imageProcess(){return d.imageProcess}};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}})},"./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/templateLoader.js??ruleSet[1].rules[3]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/packageA/pages/posterImage/posterImage.vue?vue&type=template&id=379b6607&ts=true":function(e,s,o){o.d(s,{render:function(){return render}});var t=o("./node_modules/@nutui/nutui-taro/dist/packages/button/index.mjs"),a=(o("./node_modules/@nutui/nutui-taro/dist/packages/button/style.mjs"),o("./src/components/CustomBar/CustomBar.vue")),n=o("./node_modules/vue/index.js"),r=["src"];function render(e,s,o,u,l,d){var i=a.default,c=t.Button;return(0,n.openBlock)(),(0,n.createBlock)(u.BackgroundImage,null,{default:(0,n.withCtx)((function(){return[(0,n.createElementVNode)("view",null,[(0,n.createVNode)(i,{"bg-color":"transparent","logo-color":u.LogoColorType.BLACK},null,8,["logo-color"]),(0,n.createElementVNode)("view",{class:(0,n.normalizeClass)([e.$style["pop-poster"],"nut-flex nut-flex-col nut-col-center nut-row-left"])},[(0,n.createElementVNode)("view",{class:(0,n.normalizeClass)(e.$style["poster-center"])},[u.data.startDraw?((0,n.openBlock)(),(0,n.createBlock)(u.PosterBuilder,{key:0,showLoading:!0,config:u.data.config,onSuccess:u.onImgOk,onFail:u.onImgError},null,8,["config"])):(0,n.createCommentVNode)("v-if",!0),u.image?((0,n.openBlock)(),(0,n.createElementBlock)("image",{key:1,class:(0,n.normalizeClass)(e.$style.image),src:u.imageProcess(u.image,"L"),showMenuByLongpress:!0},null,10,r)):((0,n.openBlock)(),(0,n.createElementBlock)("view",{key:2,class:(0,n.normalizeClass)(e.$style.image)},null,2))],2),(0,n.createElementVNode)("view",{class:(0,n.normalizeClass)(e.$style.footer)},[(0,n.createVNode)(c,{shape:"square",size:"large",type:"primary",class:(0,n.normalizeClass)(e.$style.btn),onClick:u.savePoster},{default:(0,n.withCtx)((function(){return[(0,n.createTextVNode)("保存到手机")]})),_:1},8,["class"])],2)],2)])]})),_:1})}},"./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/mini-css-extract-plugin/dist/loader.js!./node_modules/@tarojs/webpack5-runner/node_modules/css-loader/dist/cjs.js??clonedRuleSet-7.use[1]!./node_modules/vue-loader/dist/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-7.use[2]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??clonedRuleSet-7.use[4]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/packageA/pages/posterImage/posterImage.vue?vue&type=style&index=0&id=379b6607&lang=scss&module=true":function(e,s){s.default={"pop-poster":"posterImage__pop-poster___eVSrH","poster-center":"posterImage__poster-center___1yM8s",image:"posterImage__image___hfBZA",footer:"posterImage__footer___kO74e",btn:"posterImage__btn___FqYEl","slide-bottom":"posterImage__slide-bottom___ptdhE"}},"./src/packageA/pages/posterImage/posterImage.vue":function(e,s,o){var t=o("./node_modules/@tarojs/runtime/dist/runtime.esm.js"),a=o("./node_modules/@tarojs/taro-loader/lib/raw.js!./src/packageA/pages/posterImage/posterImage.vue");Page((0,t.createPageConfig)(a.default,"packageA/pages/posterImage/posterImage",{root:{cn:[]}},{}||{})),a.default},"./src/packageA/pages/posterImage/posterImage.vue?vue&type=script&setup=true&lang=ts":function(e,s,o){o.d(s,{default:function(){return t.default}});var t=o("./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/packageA/pages/posterImage/posterImage.vue?vue&type=script&setup=true&lang=ts")},"./src/packageA/pages/posterImage/posterImage.vue?vue&type=template&id=379b6607&ts=true":function(e,s,o){o.d(s,{render:function(){return t.render}});var t=o("./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/babel-loader/lib/index.js??clonedRuleSet-21.use[0]!./node_modules/vue-loader/dist/templateLoader.js??ruleSet[1].rules[3]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/packageA/pages/posterImage/posterImage.vue?vue&type=template&id=379b6607&ts=true")},"./src/packageA/pages/posterImage/posterImage.vue?vue&type=style&index=0&id=379b6607&lang=scss&module=true":function(e,s,o){o.d(s,{default:function(){return t.default}});var t=o("./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/mini-css-extract-plugin/dist/loader.js!./node_modules/@tarojs/webpack5-runner/node_modules/css-loader/dist/cjs.js??clonedRuleSet-7.use[1]!./node_modules/vue-loader/dist/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-7.use[2]!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??clonedRuleSet-7.use[4]!./node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/packageA/pages/posterImage/posterImage.vue?vue&type=style&index=0&id=379b6607&lang=scss&module=true")}},function(e){e.O(0,["packageA/sub-vendors","taro","vendors","common"],(function(){return s="./src/packageA/pages/posterImage/posterImage.vue",e(e.s=s);var s}));e.O()}]);